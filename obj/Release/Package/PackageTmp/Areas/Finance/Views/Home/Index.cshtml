
@{
    ViewBag.Title = "营销管理系统";
    Layout = "~/Areas/Finance/Views/Shared/_FinanceLayout.cshtml";
}

<div class="page-content">

    <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->

    <div id="portlet-config" class="modal hide">

        <div class="modal-header">

            <button data-dismiss="modal" class="close" type="button"></button>

            <h3>Widget Settings</h3>

        </div>

        <div class="modal-body">

            Widget settings form goes here

        </div>

    </div>

    <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
    <!-- BEGIN PAGE CONTAINER-->

    <div class="container-fluid">

        <!-- BEGIN PAGE HEADER-->

        <div class="row-fluid">

            <div class="span12">

                <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                <h3 class="page-title">

                    首页 <small>一目了然的仪表板</small>

                </h3>

                <!-- END PAGE TITLE & BREADCRUMB-->

            </div>

        </div>

        <!-- END PAGE HEADER-->

        <div id="dashboard">

            <!-- BEGIN DASHBOARD STATS -->

            <div class="row-fluid">

                <div class="span6 responsive" data-tablet="span6" data-desktop="span6">

                    <div class="dashboard-stat blue" href="Finance/FinanceOrder/Index?HomeState=1">

                        <div class="visual">

                            <i class="icon-comments"></i>

                        </div>

                        <div class="details" title="所有未开发票的订单">

                            <div class="number">

                                @ViewBag.NotReceiptOrderMoney

                            </div>

                            <div class="desc">
                                历史累计 @ViewBag.NotReceiptOrderCount 份未开发票订单

                            </div>

                        </div>

                        <a class="more" href="#">

                            详细信息 <i class="m-icon-swapright m-icon-white"></i>

                        </a>

                    </div>

                </div>

                <div class="span6 responsive" data-tablet="span6" data-desktop="span6">

                    <div class="dashboard-stat green" href="Finance/FinanceOrder/Index?HomeState=2">

                        <div class="visual">

                            <i class="icon-shopping-cart"></i>

                        </div>

                        <div class="details" title="所有的已开发票不足95%的订单">

                            <div class="number">@ViewBag.ReceiptNotHas95OrderCount</div>

                            <div class="desc">历史累计已开发票不足95%的订单</div>

                        </div>

                        <a class="more" href="#">

                            详细信息 <i class="m-icon-swapright m-icon-white"></i>

                        </a>

                    </div>

                </div>

                <div class="span6 responsive" data-tablet="span6  fix-offset" data-desktop="span6 fix-offset">

                    <div class="dashboard-stat purple" href="Finance/Receipt/Index?HomeState=4">

                        <div class="visual">

                            <i class="icon-bar-chart"></i>

                        </div>

                        <div class="details" title="今年已开发票所发生的收款金额/今年开发票金额">

                            <div class="number">@ViewBag.RateOfCollection%</div>

                            <div class="desc">本年度回款率（收款金额/开发票金额）</div>

                        </div>

                        <a class="more" href="#">

                            详细信息 <i class="m-icon-swapright m-icon-white"></i>

                        </a>

                    </div>

                </div>

                <div class="span6 responsive" data-tablet="span6" data-desktop="span6">

                    <div class="dashboard-stat yellow" href="Finance/Receipt/Index?HomeState=0">

                        <div class="visual">

                            <i class="icon-bar-chart"></i>

                        </div>

                        <div class="details" title="今年开发票的总金额">

                            <div class="number">@ViewBag.HasReceiptMoney</div>

                            <div class="desc">本年度总开发票金额</div>

                        </div>

                        <a class="more" href="#">

                            详细信息 <i class="m-icon-swapright m-icon-white"></i>

                        </a>

                    </div>

                </div>

                <div class="span6 responsive" data-tablet="span6  fix-offset" data-desktop="span6 fix-offset">

                    <div class="dashboard-stat yellow" href="Finance/Receipt/Index?HomeState=4">

                        <div class="visual">

                            <i class="icon-bar-chart"></i>

                        </div>

                        <div class="details" title="今年收款的总金额">

                            <div class="number">@ViewBag.HasPaymentMoney</div>

                            <div class="desc">本年度总到账金额</div>

                        </div>

                        <a class="more" href="#">

                            详细信息 <i class="m-icon-swapright m-icon-white"></i>

                        </a>

                    </div>

                </div>

            </div>

            <!-- END DASHBOARD STATS -->

            <div class="clearfix"></div>

            <div class="row-fluid">

                <div class="span12">

                    <div class="portlet box purple">

                        <div class="portlet-title">

                            <div class="caption"><i class="icon-calendar"></i>公司订单金额统计</div>

                        </div>

                        <div class="portlet-body">

                            <div class="row-fluid">

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart1" class="chart"></div>

                                        <a class="title" href="#">订单总金额 <i class="m-icon-swapright"></i></a>
                                        <small style="color:#EDC240">订单金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney) </small>

                                    </div>

                                </div>

                                <div class="margin-bottom-10 visible-phone"></div>

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart2" class="chart"></div>

                                        <a class="title" href="#">未开发票占比<i class="m-icon-swapright"></i></a>
                                        <small style="color:#EDC240">未开发票金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney- ViewBag.ReceiptMoney) </small><br />
                                        <small style="color:rgb(175,216,248)">已开发票金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.ReceiptMoney) </small>

                                    </div>

                                </div>

                                <div class="margin-bottom-10 visible-phone"></div>

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart3" class="chart"></div>

                                        <a class="title" href="#">未收款占比<i class="m-icon-swapright"></i></a>
                                        <small style="color:#EDC240">未收款金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.ReceiptMoney - ViewBag.Payment) </small><br />
                                        <small style="color:rgb(175,216,248)">已收款金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.Payment) </small>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>

                </div>

                <div class="span12 fix-offset">

                    <div class="portlet box purple">

                        <div class="portlet-title">

                            <div class="caption"><i class="icon-calendar"></i>各部门统计</div>

                        </div>

                        <div class="portlet-body">

                            <div class="row-fluid">

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart4" class="chart"></div>

                                        <a class="title" href="#">各部门订单金额 <i class="m-icon-swapright"></i></a>
                                        <small style="color:#9440ed">技术服务部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney1) </small><br />
                                        <small style="color:#4da74d">市场营销部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney2) </small>

                                    </div>

                                </div>

                                <div class="margin-bottom-10 visible-phone"></div>

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart5" class="chart"></div>

                                        <a class="title" href="#">各部门未开发票金额<i class="m-icon-swapright"></i></a>
                                        <small style="color:#9440ed">技术服务部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney1 - ViewBag.ReceiptMoney1) </small><br />
                                        <small style="color:#4da74d">市场营销部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.AllProjectMoney2 - ViewBag.ReceiptMoney2) </small>

                                    </div>

                                </div>

                                <div class="margin-bottom-10 visible-phone"></div>

                                <div class="span4">

                                    <div class="easy-pie-chart">

                                        <div id="pie_chart6" class="chart"></div>

                                        <a class="title" href="#">各部门未收款金额<i class="m-icon-swapright"></i></a>
                                        <small style="color:#9440ed">技术服务部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.ReceiptMoney1 - ViewBag.Payment1) </small><br />
                                        <small style="color:#4da74d">市场营销部金额：@ITGB.App.SalesMgmt.BLL.Common.DecimalFormart(ViewBag.ReceiptMoney2 - ViewBag.Payment2) </small>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>

                </div>
            </div>
            
        </div>

    </div>

    <!-- END PAGE CONTAINER-->

</div>


@section endScripts{
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    
<script src="~/content/js/jquery.flot.js" type="text/javascript"></script>

<script src="~/content/js/jquery.flot.pie.js" type="text/javascript"></script>

<script src="~/content/js/jquery.flot.resize.js" type="text/javascript"></script>

<script src="~/content/js/jquery.pulsate.min.js" type="text/javascript"></script>

<script src="~/content/js/date.js" type="text/javascript"></script>

<script src="~/content/js/daterangepicker.js" type="text/javascript"></script>

<script src="~/content/js/jquery.gritter.js" type="text/javascript"></script>

<script src="~/content/js/fullcalendar.min.js" type="text/javascript"></script>

<script src="~/content/js/jquery.easy-pie-chart.js" type="text/javascript"></script>

<script src="~/content/js/jquery.sparkline.min.js" type="text/javascript"></script>

<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script src="~/content/js/app.js" type="text/javascript"></script>

<script src="~/content/js/index.js" type="text/javascript"></script>

<!-- END PAGE LEVEL SCRIPTS -->
<style>
    .dashboard-stat {
        cursor: pointer;
    }
</style>

<script>

    jQuery(document).ready(function () {

        App.init(); // initlayout and core plugins
        
        //Index.init();


        $("#liHome").addClass("active");

        var contractMoney = @ViewBag.AllProjectMoney, receiptMoney = @ViewBag.ReceiptMoney, paymentMoney = @ViewBag.Payment,
            noReceiptMoney = contractMoney - receiptMoney, noPaymentMoney = receiptMoney - paymentMoney;


        if(contractMoney==0){
            contractMoney = 0.01;
        }
        var data = [{ "label": "订单金额", "data": contractMoney }];
        // DEFAULT
        $.plot($("#pie_chart1"), data, {
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });
        if(noReceiptMoney==0&&receiptMoney==0){
            noReceiptMoney=0.01;
            receiptMoney=0.01
        }
        var data2 = [{ "label": "未开发票", "data": noReceiptMoney }, { "label": "已开发票", "data": receiptMoney }];
        // DEFAULT
        $.plot($("#pie_chart2"), data2, {
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });
        if(noPaymentMoney==0&&paymentMoney==0){
            noPaymentMoney=0.01;
            paymentMoney=0.01;
        }
        var data3 = [{ "label": "未收款", "data": noPaymentMoney }, { "label": "已收款", "data": paymentMoney }];
        // DEFAULT
        $.plot($("#pie_chart3"), data3, {
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });
        var AllProjectMoney1 = @ViewBag.AllProjectMoney1 , AllProjectMoney2=@ViewBag.AllProjectMoney2 ;
        if(AllProjectMoney1==0&&AllProjectMoney2==0){
            AllProjectMoney1=0.01;
            AllProjectMoney2=0.01;
        }
        var data4 = [{ "label": "技术服务部", "data": AllProjectMoney1 }, { "label": "市场营销部", "data": AllProjectMoney2 }];
        // DEFAULT
        $.plot($("#pie_chart4"), data4, {
            colors: ["#9440ed", "#4da74d", "#cb4b4b", "#afd8f8", "#edc240"],
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });
        var noReceiptMoney1 = @ViewBag.AllProjectMoney1 -@ViewBag.ReceiptMoney1 , noReceiptMoney2 = @ViewBag.AllProjectMoney2 -@ViewBag.ReceiptMoney2 ;
        if(noReceiptMoney1==0&&noReceiptMoney2==0){
            noReceiptMoney1=0.01;
            noReceiptMoney2=0.01;
        }
        var data5 = [{ "label": "技术服务部", "data": noReceiptMoney1 }, { "label": "市场营销部", "data": noReceiptMoney2 }];
        // DEFAULT
        $.plot($("#pie_chart5"), data5, {
            colors: ["#9440ed", "#4da74d", "#cb4b4b", "#afd8f8", "#edc240"],
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });
        var noPayment1 = @ViewBag.ReceiptMoney1 -@ViewBag.Payment1 , noPayment2 = @ViewBag.ReceiptMoney2 - @ViewBag.Payment2 ;

        if(noPayment1==0&&noPayment2==0){
            noPayment1=0.01;
            noPayment2=0.01;
        }
        var data6 = [{ "label": "技术服务部", "data": noPayment1 }, { "label": "市场营销部", "data": noPayment2 }];
        // DEFAULT
        $.plot($("#pie_chart6"), data6, {
            colors: ["#9440ed", "#4da74d", "#cb4b4b", "#afd8f8", "#edc240"],
            series: {
                pie: {
                    show: true,
                    combine: {
                        color: '#999',
                        threshold: 0.1
                    }
                }
            },
            legend: {
                show: false
            }
        });

        
        $(".dashboard-stat").on("click", function () {

            window.location.href = $(this).attr("href");
            // 防止冒泡
            return false;
        })
    });

</script>

}
